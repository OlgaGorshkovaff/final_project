---
title: "–≠—Ç–∞–ø—ã —Ä–∞–±–æ—Ç—ã –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã"
---

## –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞

–Ø –≤–∑—è–ª–∞ –≤ —Ä–∞–±–æ—Ç—É —Å–±–æ—Ä–Ω–∏–∫ **–£—Ä–∞–ª—å—Å–∫–∏–µ —Å–∫–∞–∑—ã** –ü–∞–≤–ª–∞ –ë–∞–∂–æ–≤–∞ [@–ë–∞–∂–æ–≤1970]
–í—ã–±—Ä–∞–ª–∞ —Å–∫–∞–∑ **–û–≥–Ω–µ–≤—É—à–∫–∞-–ü–æ—Å–∫–∞–∫—É—à–∫–∞**, –æ–Ω –Ω–µ–±–æ–ª—å—à–æ–π, –Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç —Ñ–æ—Ä–º–∞–ª—å–Ω—ã–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º.

# –≠—Ç–∞–ø –ø–µ—Ä–≤—ã–π: —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ (OCR) —Å –ø–æ–º–æ—â—å—é {tesseract}

## –î–ª—è –Ω–∞—á–∞–ª–∞ –≤—ã—Ä–µ–∂–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å—Ç—Ä–∞–Ω–∏—Ü –∏–∑ pdf, –æ–±—Ä–µ–∂–µ–º –æ–±–ª–æ–∂–∫—É –∏ –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞–º –Ω–µ –ø–æ–Ω–∞–¥–æ–±—è—Ç—Å—è

```{r, message = FALSE, results = 'hide'}
library(qpdf)
library(pdftools)
text_ogn <- list.files("../bazhov_final", pattern = "pdf", full.names = TRUE)
text_ogn

pdf_subset(input = "bazhov_uralskie_skazy_1970.pdf",
           output = "./–ë–∞–∂–æ–≤_–≤—ã—Ä–µ–∑–∫–∞.pdf",
           pages = c(171:179,181:182))
```

–¢–µ–∫—Å—Ç –≤ –Ω–∞—à–µ–º —Ñ–∞–π–ª–µ —É–∂–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω –±–ª–∞–≥–æ–¥–∞—Ä—è —Ö–æ—Ä–æ—à–∏–º –ª—é–¥—è–º, –Ω–æ –ø—Ä–∏—Ç–≤–æ—Ä–∏–º—Å—è, —á—Ç–æ –Ω–µ—Ç.

## –†–∞—Å–ø–æ–∑–Ω–∞–µ–º —Ç–µ–∫—Å—Ç —Å–Ω–æ–≤–∞ –∏ —Å–Ω–æ–≤–∞

```{r, message = FALSE, results = 'hide'}
library(tesseractgt)
#tesseract_download("rus")
```

–ü—Ä–µ–æ–±—Ä–∞–∑–∏–º –Ω–∞—à pdf –≤ —Å–µ—Ä–∏—é –∫–∞—Ä—Ç–∏–Ω–æ–∫. –°–Ω–∞—á–∞–ª–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–µ–º —Ç–µ–∫—Å—Ç –≤ —Ñ–∞–π–ª–µ

```{r, message = FALSE}
text_ogn_ocr <- pdf_ocr_text("./–ë–∞–∂–æ–≤_–≤—ã—Ä–µ–∑–∫–∞.pdf", 
                      language = "rus")
```

```{r, message = FALSE}
head(text_ogn_ocr,2)
```
–í–∏–¥–∏–º, —á—Ç–æ –µ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º–∞ —Å —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ–º —Ä–∏—Å—É–Ω–∫–∞ –≤ –∫–Ω–∏–≥–µ –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Å–∏–º–æ–≤–æ–ª–æ–≤. –ü–æ–ø—Ä–æ–±—É–µ–º —ç—Ç–æ –ø–æ–ø—Ä–∞–≤–∏—Ç—å!

## –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º pdf –≤ —Å—Ç—Ä–∞–Ω–∏—Ü—ã png

```{r,message = FALSE, results = 'hide'}
pdf_convert("./–ë–∞–∂–æ–≤_–≤—ã—Ä–µ–∑–∫–∞.pdf", 
            format = "png", 
            dpi = 300,
            pages = NULL,
            filenames = NULL)
```

–î—É–º–∞—é, —á—Ç–æ –ª—É—á—à–µ –≤—Å–µ–≥–æ –≤ –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ –±—É–¥–µ—Ç –ø—Ä–æ—Å—Ç–æ –æ–±—Ä–µ–∑–∞—Ç—å —Ä–∏—Å—É–Ω–æ–∫

```{r,message = FALSE, results = 'hide'}
library(magick)
img <- image_read("–ë–∞–∂–æ–≤_–≤—ã—Ä–µ–∑–∫–∞_1.png")
img_cropped <- image_crop(img, "100%x100%+0%+1100%")  #–º–µ—Ç–æ–¥–æ–º –ø–æ–¥–±–æ—Ä–∞
image_write(img_cropped, "–ë–∞–∂–æ–≤_–≤—ã—Ä–µ–∑–∫–∞_1.png")
```

![](–ë–∞–∂–æ–≤_–≤—ã—Ä–µ–∑–∫–∞_1.png)

## –ó–∞–ø—É—Å—Ç–∏–º OCR –Ω–∞ –Ω–∞—à–∏—Ö –∫–∞—Ä—Ç–∏–Ω–∫–∞—Ö

```{r,message = FALSE}
png_files <- list.files(pattern = "–ë–∞–∂–æ–≤_–≤—ã—Ä–µ–∑–∫–∞_.*\\.png$", full.names = TRUE)
sorted_png_files <- png_files[order(as.numeric(gsub(".*_(\\d+).*\\.png$", "\\1", png_files)))]
ocr_text <- tesseract::ocr(sorted_png_files, engine = "rus")
head (ocr_text,2)
```
–ò —Å–∫–ª–µ–∏–º –≤—Å—ë, —á—Ç–æ –Ω–∞–º —Ä–∞—Å–ø–æ–∑–Ω–∞–ª–∞ —ç—Ç–∞ —á—É–¥–æ-–º–∞—à–∏–Ω–∞ –≤ —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª

```{r,message = FALSE, results = 'hide'}
writeLines(ocr_text, con = "./–ë–∞–∂–æ–≤_OCR.txt")
```

![](2.jpg)


# –≠—Ç–∞–ø –≤—Ç–æ—Ä–æ–π: —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è OCR-–æ—à–∏–±–æ–∫ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞

## –ó–∞–≥—Ä—É–∑–∏–º —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–π –Ω–∞–º–∏ —Ç–µ–∫—Å—Ç

```{r,message = FALSE}
library(stringr)
text <- readLines(con = "./–ë–∞–∂–æ–≤_OCR.txt")
head(text,27)
```

–í–∏–¥–∏–º, —á—Ç–æ —É –Ω–∞—Å –æ—Å—Ç–∞–ª–∏—Å—å –Ω–æ–º–µ—Ä–∞ —Å—Ç—Ä–∞–Ω–∏—Ü –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞–ª–µ–Ω—å–∫–∏–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞. –ß—É—Ç—å-—á—É—Ç—å –ø–æ–¥–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º.

## –£–¥–∞–ª–∏–º –≤—Å–µ —Å—Ç—Ä–æ–∫–∏ —Å —Ü–∏—Ñ—Ä–∞–º–∏ - –≤ –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ —ç—Ç–æ –Ω–æ–º–µ—Ä–∞ —Å—Ç—Ä–∞–Ω–∏—Ü, –æ–Ω–∏ –Ω–∞–º –Ω–∏ –∫ —á–µ–º—É

```{r, message = FALSE}
text2 <- text[!str_detect(text, "\\d")]
head(text2,27)
```
–ö–∞–∫ –±—É–¥—Ç–æ –≤—Å—ë –∏ —Ö–æ—Ä–æ—à–æ? –ù–æ –Ω–µ—Ç, —Å–∫–ª–µ–∏–º –ø–µ—Ä–µ–Ω–æ—Å—ã —Å–ª–æ–≤, —á—Ç–æ–±—ã –±—ã–ª–æ —Ç–æ—á–Ω–æ —Å–ª–∞–≤–Ω–æ

## –°–∫–ª–µ–∏–≤–∞–µ–º –ø–µ—Ä–µ–Ω–æ—Å—ã —Å–ª–æ–≤

```{r, message = FALSE, results = 'hide'}
text3 <- paste(text2, collapse = "\n")
pattern <- "(\\p{L}+)-\\s*\\n\\s*(\\p{L}+)"
text4 <- gsub(pattern, "\\1\\2", text3, perl = TRUE)
print(text4)
```

–í–∏–¥–∏–º, —á—Ç–æ –≤ —Ç–µ–∫—Å—Ç –∏–∑-–∑–∞ –æ—à–∏–±–æ–∫ –≤ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–∏ –∑–∞–∫—Ä–∞–ª–∞—Å—å —Å–∫–æ–±–∫–∞ –∏ –æ–¥–Ω–∞ –æ–ø–µ—á–∞—Ç–∫–∞, –∫–æ—Ç–æ—Ä—ã—Ö –≤ —Å–∞–º–æ–º —Ç–µ–∫—Å—Ç–µ –Ω–µ—Ç

## –í–Ω–µ—Å–µ–º –∫–æ—Ä—Ä–µ–∫—Ç–∏–≤—ã –∏ –∑–∞–ø–∏—à–µ–º –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—É—é —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫—É –≤ —Ñ–∞–π–ª

```{r, message = FALSE, results = 'hide'}
text5 <- text4 |>
  str_remove_all("[()]") |>
  str_replace_all('\"–ì—É—Ç', '–¢—É—Ç')
print(text5)

writeLines(text5, con = "./–ë–∞–∂–æ–≤_NORM.txt")
```

![](3.jpg)


# –≠—Ç–∞–ø —Ç—Ä–µ—Ç–∏–π: —Ä–∞–∑–º–µ—Ç–∏–º —Ç–µ–∫—Å—Ç TEI

–†–∞–∑–º–µ—á–∞—Ç—å –ø–æ–ª—É—á–µ–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –±—É–¥–µ–º —Å –ø–æ–º–æ—â—å—é –∞–≥—Ä–µ–≥–∞—Ç–æ—Ä–∞ LLM-–º–æ–¥–µ–ª–µ–π OpenRouter. –Ø –ø–µ—Ä–µ–ø—Ä–æ–±–æ–≤–∞–ª–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–æ–¥–µ–ª–µ–π (openai/gpt-oss-120b:free, qwen/qwen3-235b-a22b:free), –Ω–æ –æ–Ω–∏ –ª–∏–±–æ –±—ã–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã, –ª–∏–±–æ –≤—ã–¥–∞–≤–∞–ª–∏ –æ—à–∏–±–∫—É. –ü–æ—ç—Ç–æ–º—É —è –æ—Å—Ç–∞–Ω–æ–≤–∏–ª–∞—Å—å –Ω–∞ –º–æ–¥–µ–ª–∏ **google/gemma-3-27b-it:free**, –æ–Ω–∞ –¥–∞–ª–∞ –±–æ–ª–µ–µ –º–µ–Ω–µ–µ –ø—Ä–∏—è—Ç–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç!

–ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ, –ø—Ä–∏–≤—è–∑—ã–≤–∞–µ–º –∫–ª—é—á, –Ω–æ —è –µ–≥–æ –≤–∞–º –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –Ω–µ –±—É–¥—É:)

–ó–∞–≥—Ä—É–∂–∞–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫—É, –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç, –≤—ã–±–∏—Ä–∞–µ–º –º–æ–¥–µ–ª—å. –§–æ—Ä–º—É–ª–∏—Ä—É–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –ø—Ä–æ–º–ø—Ç (–≤–æ–∑–º–æ–∂–Ω–æ, –µ–≥–æ –º–æ–∂–Ω–æ –¥–æ–∫—Ä—É—Ç–∏—Ç—å –¥–æ –µ—â–µ –±–æ–ª–µ–µ –∏–¥–µ–∞–ª—å–Ω–æ–≥–æ, –Ω–æ –º–Ω–µ –∫–∞–∂–µ—Ç—Å—è, —á—Ç–æ –ø–æ–¥–æ–π–¥–µ—Ç –∏ —Ç–∞–∫–æ–π), –∫–∏–¥–∞–µ–º —ç—Ç–æ –≤—Å—ë –Ω–∞—à–µ–π –º–æ–¥–µ–ª–∏ –∏ –∂–¥—ë–º...


```{r, include = FALSE}
Sys.setenv(OPENROUTER_API_KEY = "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")
Sys.getenv("OPENROUTER_API_KEY")
```

```{r, message = FALSE, results = 'hide'}
library(ellmer)
options(timeout = 600) #–û—à–∏–±–∫–∞ —Ç–∞–π–º–∞—É—Ç–∞ –ø—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ OpenRouter API, –ø–æ—ç—Ç–æ–º—É —É–≤–µ–ª–∏—á–∏–≤–∞—é –≤—Ä–µ–º—è –≤ –Ω–∞–¥–µ–∂–¥–µ, —á—Ç–æ —Å–∞–π—Ç –∑–∞—Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è
chat <- chat_openrouter(
  system_prompt = "–¢—ã —ç–∫—Å–ø–µ—Ä—Ç –ø–æ —Ç–µ–∫—Å—Ç–æ–≤–æ–π —Ä–∞–∑–º–µ—Ç–∫–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ TEI.
  –†–∞–∑–º–µ—Ç—å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç —Å–∫–∞–∑–∞ –ü–∞–≤–ª–∞ –ë–∞–∂–æ–≤–∞ '–û–≥–Ω–µ–≤—É—à–∫–∞-–ü–æ—Å–∫–∞–∫—É—à–∫–∞' –≤ —Ñ–æ—Ä–º–∞—Ç–µ TEI XML. –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ:
  1. –í—ã–¥–µ–ª–∏ –∞–±–∑–∞—Ü—ã <p>
  2. –í—ã–¥–µ–ª–∏ –∏–º–µ–Ω–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ <persName> (–¢—é–Ω—å—à/–§–µ–¥—é–Ω, –¥–µ–¥–∫–æ –ï—Ñ–∏–º/–î–µ–¥–∫–æ –ï—Ñ–∏–º/–ï—Ñ–∏–º, –°—Ç–∞—Ä–∞—Ç–µ–ª/—Å—Ç–∞—Ä–∞—Ç–µ–ª, –û—Ç–µ—Ü –§–µ–¥—é–Ω—å–∫–∏, –ú–∞—á–µ—Ö–∞, –û–≥–Ω–µ–≤—É—à–∫–∞-–ü–æ—Å–∫–∞–∫—É—à–∫–∞/–ü–æ—Å–∫–∞–∫—É—à–∫–∞ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–Ω—ã–µ)
  3. –í—ã–¥–µ–ª–∏ –¥–∞—Ç—ã <date>
  4. –ú–µ—Å—Ç–∞: <placeName> —Å –∞—Ç—Ä–∏–±—É—Ç–æ–º type
  5. –°–æ—Ö—Ä–∞–Ω–∏ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–µ–∫—Å—Ç–∞
  6. –í–µ—Ä–Ω–∏ TEI —Ä–∞–∑–º–µ—Ç–∫—É",
  api_key = Sys.getenv("OPENROUTER_API_KEY"),
  model = "google/gemma-3-27b-it:free"
)

user_prompt <- paste("–†–∞–∑–º–µ—Ç—å –≤ TEI —Å–ª–µ–¥—É—é—â–∏–π —Ç–µ–∫—Å—Ç, –Ω–∞—á–Ω–∏ —Å –Ω–∞—á–∞–ª–∞ —Ç–µ–∫—Å—Ç–∞, –∞ –Ω–µ —Å —Å–µ—Ä–µ–¥–∏–Ω—ã.–¢–û–õ–¨–ö–û:,
                    - <p> –¥–ª—è –∞–±–∑–∞—Ü–µ–≤,
                    - <persName> –¥–ª—è –∏–º–µ–Ω, 
                    - <date> –¥–ª—è –¥–∞—Ç,
                    - <said> –¥–ª—è –ø—Ä—è–º–æ–π —Ä–µ—á–∏,
                    –ù–ï –ò–°–ü–û–õ–¨–ó–£–ô <br/>, <div> –∏–ª–∏ –¥—Ä—É–≥–∏–µ —Ç–µ–≥–∏. –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Ä–∞–∑–º–µ—á–∞–π –í–ï–°–¨ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –¥–æ –∫–æ–Ω—Ü–∞, 
–Ω–µ –æ–±—Ä—ã–≤–∞–π –æ—Ç–≤–µ—Ç. –ï—Å–ª–∏ —Ç–µ–∫—Å—Ç –¥–ª–∏–Ω–Ω—ã–π, –ø—Ä–æ–¥–æ–ª–∂–∞–π —Å —Ç–æ–≥–æ –º–µ—Å—Ç–∞, 
–≥–¥–µ –æ—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è", text5)

result <- chat$chat(user_prompt)

result_clean <- str_remove_all(result, "```xml|```")
xml_clean <- sub("^,", "", result_clean)
xml_clean <- sub("^\n+", "", xml_clean)

writeLines(xml_clean, con = "–û–≥–Ω–µ–≤—É—à–∫–∞TEI.xml")

```

–í –ø—Ä–æ—Ü–µ—Å—Å–µ –≤–æ–∑–Ω–∏–∫–ª–∞ –ø—Ä–æ–±–ª–µ–º–∞: –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ —Å–æ–∑–¥–∞–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –Ω–∞—á–∏–Ω–∞–ª—Å—è —Å ```xml, –∞ –Ω–µ —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –æ–±—Ä–∞–±–æ—Ç–∫–µ XML (<?xml version="1.0" encoding="utf-8"?>). –ë–µ–∑ —ç—Ç–æ–≥–æ –≤—Å—ë –ª–æ–º–∞–ª–æ—Å—å –∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–ª–æ –¥–∞–ª—å—à–µ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ. –ü—Ä–∏—à–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å —Ä–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ, —á—Ç–æ–±—ã –ø–æ—á–∏—Å—Ç–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç.

–†–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–≥—Ä—É–∂–∞–µ–º –≤ —Ñ–∞–π–ª .xml, –Ω–æ –º–æ–∂–µ–º –Ω–µ–º–Ω–æ–≥–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ —Ç–æ, —á—Ç–æ –ø–æ–ª—É—á–∏–ª–æ—Å—å —Ç–∞–∫:

<?xml version="1.0" encoding="UTF-8"?>
<TEI xmlns="http://www.tei-c.org/ns/1.0">
  <teiHeader>
    <fileDesc>
      <titleStmt>
        <title>–û–≥–Ω–µ–≤—É—à–∫–∞-–ü–æ—Å–∫–∞–∫—É—à–∫–∞</title>
        <author>–ü–∞–≤–µ–ª –ë–∞–∂–æ–≤</author>
      </titleStmt>
      <publicationStmt>
        <p>–î–ª—è —É—á–µ–±–Ω—ã—Ö —Ü–µ–ª–µ–π</p>
      </publicationStmt>
      <sourceDesc>
        <p>–ò—Å—Ö–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç</p>
      </sourceDesc>
    </fileDesc>
  </teiHeader>
  <text>
    <body>
      <p>–°–∏–¥–µ–ª–∏ —Ä–∞–∑ <persName>—Å—Ç–∞—Ä–∞—Ç–µ–ª–∏</persName> –∫—Ä—É–≥ –æ–≥–æ–Ω—å–∫–∞ –≤ –ª–µ—Å—É. –ß–µ—Ç–≤–µ—Ä–æ –±–æ–ª—å—à–∏—Ö, –∞ –ø—è—Ç—ã–π –ø–∞—Ä–Ω–∏—à–µ—á–∫–æ. –õ–µ—Ç —Ç–∞–∫ 
–≤–æ—Å—å–º–∏, –Ω–µ –±–æ–ª—å—à–µ, <persName>–§–µ–¥—é–Ω—å–∫–æ–π</persName> –µ–≥–æ –∑–≤–∞–ª–∏.</p>

![](5.jpg)


# –≠—Ç–∞–ø —á–µ—Ç–≤–µ—Ä—Ç—ã–π: –∞–Ω–∞–ª–∏–∑ TEI-—Ä–∞–∑–º–µ—Ç–∫–∏ —Å –ø–æ–º–æ—â—å—é {xml2}

–ù–∞ —ç—Ç–æ–º —ç—Ç–∞–ø–µ –Ω–∞–º –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ {xml2}, –ø—Ä–∏–≤—è–∑—ã–≤–∞–µ–º –µ—ë –∏ –ø–æ–µ—Ö–∞–ª–∏:)

## –ü–∞—Ä—Å–∏–Ω–≥ –∏ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –∏–º–µ–Ω

```{r, message = FALSE}
library(xml2)
library(tidyverse)
library(dplyr)
library(purrr)

doc <- read_xml("–û–≥–Ω–µ–≤—É—à–∫–∞TEI.xml")
ns <- xml_ns(doc)

```

–î–æ–∫—É–º–µ–Ω—Ç –∑–∞–ø–∞—Ä—Å–∏–ª–∏, –∑–∞–¥–∞–ª–∏ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –∏–º—ë–Ω, –¥–∞–≤–∞–π—Ç–µ –Ω–∞–π–¥–µ–º —á—Ç–æ-–Ω–∏–±—É–¥—å –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–µ.

## –°–º–æ—Ç—Ä–∏–º –¥–∞–Ω–Ω—ã–µ –ø–æ —Ç–µ–≥—É persName

```{r}
characters <- xml_find_all(doc, "//d1:persName", ns = ns) |>
  xml_text()

character_names <- unique(characters)

character_counts <- table(character_names) |> 
  as.data.frame() |> 
  arrange(desc(Freq))

head(character_counts)
```

–í–æ-–ø–µ—Ä–≤—ã—Ö, —è–≤–Ω–æ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å —Å—Ç–æ–ª–±—Ü—ã, —á—Ç–æ–± –±—ã–ª–æ –∫—Ä–∞—Å–∏–≤–æ.

```{r}
colnames(character_counts) <- c("–ò–º—è", "–ß–∞—Å—Ç–æ—Ç–∞")

head(character_counts)
```

–í–æ-–≤—Ç–æ—Ä—ã—Ö, —É –Ω–∞—Å –µ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º–∞ —Å —Ç–µ–º, —á—Ç–æ –º—ã –ø–æ–ª—É—á–∏–ª–∏ —Å–ø–∏—Å–æ–∫ –∏–º–µ–Ω –≤–æ –≤—Å–µ—Ö –∏—Ö –≤–∞—Ä–∏–∞—Ü–∏—è—Ö, –∞ –Ω–∞–º –Ω—É–∂–Ω—ã —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π!

–Ø —Å–¥–µ–ª–∞—é —ç—Ç–æ –≤—Ä—É—á–Ω—É—é, —Ç–∞–∫ –±—É–¥–µ—Ç –Ω–∞–¥–µ–∂–Ω–µ–µ, –º–æ–∂–Ω–æ –±—ã–ª–æ –±—ã –ª–µ–º–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å, –∫–æ–Ω–µ—á–Ω–æ –∏ –±–µ–∑—É—Å–ª–æ–≤–Ω–æ... But and so...

```{r, echo = FALSE}
name_groups <- c(
  "–¥–µ–¥–∫–æ –ï—Ñ–∏–º" = "–¥–µ–¥–∫–æ –ï—Ñ–∏–º",      
  "–î–µ–¥–∫–æ –ï—Ñ–∏–º" = "–¥–µ–¥–∫–æ –ï—Ñ–∏–º",      
  "–¥–µ–¥ –ï—Ñ–∏–º" = "–¥–µ–¥–∫–æ –ï—Ñ–∏–º",        
  "–§–µ–¥—é–Ω—å–∫—É" = "–§–µ–¥—é–Ω—å–∫–∞",          
  "–§–µ–¥—é–Ω—å–∫–µ" = "–§–µ–¥—é–Ω—å–∫–∞",          
  "–§–µ–¥—é–Ω—å–∫–∏" = "–§–µ–¥—é–Ω—å–∫–∞",          
  "–§–µ–¥—é–Ω—å–∫–∏–Ω" = "–§–µ–¥—é–Ω—å–∫–∞",
  "–§–µ–¥—é–Ω—å–∫–æ–π" = "–§–µ–¥—é–Ω—å–∫–∞",
  "—Å—Ç–∞—Ä–∞—Ç–µ–ª–µ–π" = "—Å—Ç–∞—Ä–∞—Ç–µ–ª–∏",       
  "—Å—Ç–∞—Ä–∞—Ç–µ–ª—å" = "—Å—Ç–∞—Ä–∞—Ç–µ–ª–∏",       
  "–°—Ç–∞—Ä–∞—Ç–µ–ª—å" = "—Å—Ç–∞—Ä–∞—Ç–µ–ª–∏",        
  "—Å—Ç–∞—Ä–∞—Ç–µ–ª–∏" = "—Å—Ç–∞—Ä–∞—Ç–µ–ª–∏",        
  "–°—Ç–∞—Ä–∞—Ç–µ–ª–∏" = "—Å—Ç–∞—Ä–∞—Ç–µ–ª–∏",        
  "–ü–æ—Å–∫–∞–∫—É—à–∫—É" = "–û–≥–Ω–µ–≤—É—à–∫–∞-–ü–æ—Å–∫–∞–∫—É—à–∫–∞",  
  "–ü–æ—Å–∫–∞–∫—É—à–∫–∏–Ω–∞" = "–û–≥–Ω–µ–≤—É—à–∫–∞-–ü–æ—Å–∫–∞–∫—É—à–∫–∞",    
  "–û–≥–Ω–µ–≤—É—à–∫–∞-–ü–æ—Å–∫–∞–∫—É—à–∫–∞" = "–û–≥–Ω–µ–≤—É—à–∫–∞-–ü–æ—Å–∫–∞–∫—É—à–∫–∞",
  "–¢—é–Ω—å–∫–∞ –ü–æ—Å–∫–∞–∫—É—à–∫–∞" = "–û–≥–Ω–µ–≤—É—à–∫–∞-–ü–æ—Å–∫–∞–∫—É—à–∫–∞",
  "–¢—é–Ω—å–∫–æ–π –ü–æ—Å–∫–∞–∫—É—à–∫–æ–π" = "–û–≥–Ω–µ–≤—É—à–∫–∞-–ü–æ—Å–∫–∞–∫—É—à–∫–∞",
  "–¢—é–Ω—å—à–∞" = "–û–≥–Ω–µ–≤—É—à–∫–∞-–ü–æ—Å–∫–∞–∫—É—à–∫–∞",
  "–æ—Ç—Ü–∞" = "–æ—Ç–µ—Ü",                  
  "–æ—Ç–µ—Ü" = "–æ—Ç–µ—Ü",                  
  "–û—Ç–µ—Ü" = "–æ—Ç–µ—Ü",                  
  "–ú–∞—á–µ—Ö–∞" = "–ú–∞—á–µ—Ö–∞",             
  "–ï—Ñ–∏–º" = "–¥–µ–¥–∫–æ –ï—Ñ–∏–º",                  
  "–ï—Ñ–∏–º—É" = "–¥–µ–¥–∫–æ –ï—Ñ–∏–º",                 
  "–ï—Ñ–∏–º–æ–º" = "–¥–µ–¥–∫–æ –ï—Ñ–∏–º",               
  "–¥–µ–¥–∫–∞ –ï—Ñ–∏–º–∞" = "–¥–µ–¥–∫–æ –ï—Ñ–∏–º",    
  "–¥–µ–¥–∫—É –ï—Ñ–∏–º—É" = "–¥–µ–¥–∫–æ –ï—Ñ–∏–º",    
  "–¥–µ–¥—É –ï—Ñ–∏–º—É" = "–¥–µ–¥–∫–æ –ï—Ñ–∏–º",    
  "–¥–µ–¥–æ–≤—ã" = "–¥–µ–¥–∫–æ –ï—Ñ–∏–º",      
  "–î–µ–¥–æ" = "–¥–µ–¥–∫–æ –ï—Ñ–∏–º",
  "–¥–µ–¥—É" = "–¥–µ–¥–∫–æ –ï—Ñ–∏–º",
  "–ü–æ—Å–∫–∞–∫—É—à–∫–∞" = "–û–≥–Ω–µ–≤—É—à–∫–∞-–ü–æ—Å–∫–∞–∫—É—à–∫–∞",
  "–ï—Ñ–∏–º–æ–º –ó–æ–ª–æ—Ç–∞—è –†–µ–¥—å–∫–∞" = "–¥–µ–¥–∫–æ –ï—Ñ–∏–º",
  "–¥–µ–¥–∫–æ" = "–¥–µ–¥–∫–æ –ï—Ñ–∏–º",
  "–§–µ–¥—é–Ω—å–∫–∏–Ω–æ–≥–æ" = "–§–µ–¥—é–Ω—å–∫–∞",
  "–î–µ–¥ –ï—Ñ–∏–º" = "–¥–µ–¥–∫–æ –ï—Ñ–∏–º",
  "–¥–µ–¥–∫–µ –ï—Ñ–∏–º—É" = "–¥–µ–¥–∫–æ –ï—Ñ–∏–º",
  "–¢—è—Ç—è" = "–æ—Ç–µ—Ü"
)

normalized_chars <- sapply(characters, function(name) {
  if (name %in% names(name_groups)) {
    return(name_groups[[name]])
  } else {
    return(name)
  }
})

character_counts <- table(normalized_chars) |> 
  as.data.frame() |> 
  arrange(desc(Freq))

colnames(character_counts) <- c("–ò–º—è", "–ß–∞—Å—Ç–æ—Ç–∞")

print(character_counts)
```

# –í–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ

–ò —Å–¥–µ–ª–∞–µ–º –Ω–µ–±–æ–ª—å—à–æ–π –≥—Ä–∞—Ñ–∏–∫, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º –Ω–∞–≥–ª—è–¥–Ω–æ –±—É–¥–µ—Ç –ø–æ–∫–∞–∑–∞–Ω–æ, —Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ —É–ø–æ–º–∏–Ω–∞—é—Ç—Å—è –≥–µ—Ä–æ–∏.

```{r, echo = FALSE}
ggplot(character_counts, aes(x = reorder(–ò–º—è, –ß–∞—Å—Ç–æ—Ç–∞), y = –ß–∞—Å—Ç–æ—Ç–∞, fill = –ß–∞—Å—Ç–æ—Ç–∞)) +
  geom_col(width = 0.8) +
  scale_fill_gradient(low = "#FFD700", high = "#DC143C", name = "–ß–∞—Å—Ç–æ—Ç–∞") +
  geom_text(aes(label = –ß–∞—Å—Ç–æ—Ç–∞), 
            hjust = -0.3, 
            size = 4.5, 
            fontface = "bold") +
  coord_flip() +
  labs(
    title = "üìö –ì–µ—Ä–æ–∏ —Å–∫–∞–∑–∞ –ë–∞–∂–æ–≤–∞ –û–≥–Ω–µ–≤—É—à–∫–∞-–ø–æ—Å–∫–∞–∫—É—à–∫–∞",
    subtitle = "–ö—Ç–æ —á–∞—â–µ –≤—Å–µ–≥–æ —É–ø–æ–º–∏–Ω–∞–µ—Ç—Å—è –≤ —Ç–µ–∫—Å—Ç–µ?",
    x = "–ü–µ—Ä—Å–æ–Ω–∞–∂",
    y = "–£–ø–æ–º–∏–Ω–∞–Ω–∏—è"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    plot.title = element_text(face = "bold", size = 18, hjust = 0.5),
    plot.subtitle = element_text(color = "gray50", size = 13, hjust = 0.5),
    legend.position = "none",
    axis.text = element_text(size = 12)
  )
```
–ö—Ä–∞—Å–æ—Ç–∞ –∂–µ?

![](6.jpg)
