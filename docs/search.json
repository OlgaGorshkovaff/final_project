[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Несколько слов о материалах и теме",
    "section": "",
    "text": "Я очень хотела взять текст о своем любимом Незнайке, но оказалось, что это не так просто.\nПоэтому в этой работе я взяла для анализа небольшой сказ Павла Бажова."
  },
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "Этапы работы и результаты",
    "section": "",
    "text": "Я взяла в работу сборник Уральские сказы Павла Бажова (Бажов 1970) Выбрала сказ Огневушка-Поскакушка, он небольшой, но подходит формальным критериям."
  },
  {
    "objectID": "about.html#для-начала-вырежем-несколько-страниц-из-pdf-обрежем-обложку-и-входные-данные-которые-нам-не-понадобятся",
    "href": "about.html#для-начала-вырежем-несколько-страниц-из-pdf-обрежем-обложку-и-входные-данные-которые-нам-не-понадобятся",
    "title": "Этапы работы и результаты",
    "section": "Для начала вырежем несколько страниц из pdf, обрежем обложку и входные данные, которые нам не понадобятся",
    "text": "Для начала вырежем несколько страниц из pdf, обрежем обложку и входные данные, которые нам не понадобятся\n\nlibrary(qpdf)\nlibrary(pdftools)\ntext_ogn &lt;- list.files(\"../bazhov_final\", pattern = \"pdf\", full.names = TRUE)\ntext_ogn\n\npdf_subset(input = \"bazhov_uralskie_skazy_1970.pdf\",\n           output = \"./Бажов_вырезка.pdf\",\n           pages = c(171:179,181:182))\n\nТекст в нашем файле уже распознан благодаря хорошим людям, но притворимся, что нет."
  },
  {
    "objectID": "about.html#распознаем-текст-снова-и-снова",
    "href": "about.html#распознаем-текст-снова-и-снова",
    "title": "Этапы работы и результаты",
    "section": "Распознаем текст снова и снова",
    "text": "Распознаем текст снова и снова\n\nlibrary(tesseractgt)\n#tesseract_download(\"rus\")\n\nПреобразим наш pdf в серию картинок. Сначала распознаем текст в файле\n\ntext_ogn_ocr &lt;- pdf_ocr_text(\"./Бажов_вырезка.pdf\", \n                      language = \"rus\")\n\nConverting page 1 to Бажов_вырезка_1.png...\n\n\n done!\nConverting page 2 to Бажов_вырезка_2.png... done!\nConverting page 3 to Бажов_вырезка_3.png... done!\nConverting page 4 to Бажов_вырезка_4.png... done!\nConverting page 5 to Бажов_вырезка_5.png... done!\nConverting page 6 to Бажов_вырезка_6.png... done!\nConverting page 7 to Бажов_вырезка_7.png... done!\nConverting page 8 to Бажов_вырезка_8.png... done!\nConverting page 9 to Бажов_вырезка_9.png... done!\nConverting page 10 to Бажов_вырезка_10.png... done!\nConverting page 11 to Бажов_вырезка_11.png... done!\n\n\n\nhead(text_ogn_ocr,2)\n\n[1] \"——=—=— в м о. й | р кН\\nзн \\\"=&gt; . = о 7 о А и ну \\\"\\nо а Се - м о ИИ . 9!\\n\\n—. = Е Е т. в У и\\\", паг.\\n\\nЕЕ 9.” Жи\\n\\nван —— — ЕЕ — -- 2 -. у Й И ео - ' ч).\\n\\nа о =. |) 5.477), А\\n\\nУ Оо 2, У:\\n\\nА “ОИ Й № ОА |\\n\\nа А а. у Ч И. у\\n^^ |. (7. а и. ТВ\\n\\n== и р “ | ”. =” г 4, Ро —. 7; &lt;” 0; . , „7\\n\\n=“ и. : РАВ &gt; &gt; , `. „и М\\n, & ве-- 778 7 С“ ЯЗ Г ” , 7”. ГВ\\n—= Илии, УВВ. 0 37 —. МА 29,\\nЕЯ АА и в: С ТОЩаь\\\" ЧБ\\n— Н у МИИ&gt; А абы с р\\n. — , и хи, у =. чи ще ‘’ ом ин И -ь`,\\n=) и Эс 2-Х м\\n| / ” а = «&gt; 272 3-й И К щщ\\nРР (&gt; РР \\\"обоев.\\nчм . хе. -—— &lt;&gt; &lt;“. . .. ` (т.о &gt; : 7; 22% &gt; =\\nт о. &lt;\\n—. м. | . 7\\n° о А,\\nОГНЕВУШКА-ПОСКАКУШКА\\n\\n“(Сидели раз старатели круг огонька в лесу. Четверо\\nбольших, а пятый парнишечко. Лет так восьми, не больше,\\nФедюнькой его звали.\\n\\nДавно всем спать пора, да разговор занятный пришелся.\\nВ артелке, видишь, один старик был. Дедко Ефим. С моло-\\nдых годов он из земли золотую крупку выбирал. Мало ли\\nкаких случаев у него бывало. Он и рассказывал, а старатели\\nслушали.\\n\\nОтец уж сколько раз говорил Федюньке!\\n\\n— Ложился бы ты, Тюньша, спать!\\n\\nПарнишечку охота послушать.\\n\\n— Погоди, тятенька! Я маленечко еще посижу.\\n\\nНу, вот.... Кончил дедко Ефим рассказ. На месте костер-\\nка одни угольки остались, а старатели всё сидят да на эти\\nугольки глядят.\\n\\n168\\n\"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  \n[2] \"Вдруг из самой серединки вынырнула девчоночка махонь-\\nка. Вроде кукленки, а живая. Волосенки рыженькие, сара-\\nфанчик голубенький и в руке платочек, тоже сголуба *.\\n\\nПоглядела девчонка веселыми глазками, блеснула зубен-\\nками, подбоченилась, платочком махнула и пошла плясать.\\nИ так у ней легко да ловко выходит, что и сказать нельзя.\\nУ старателей дух захватило. Глядят — не наглядятся, а сами\\nмолчат, будто задумались.\\n\\nДевчонка сперва по уголькам круги давала, потом, — вид-\\nно, ей тесно стало, — пошире пошла. Старатели отодвигают-\\nся, дорогу дают, а девчонка как круг пройдет, так и подрастет\\nмаленько. Старатели дальше отодвинутся. Она еще круг даст\\nи опять подрастет. Когда вовсе далеко отодвинулись, дев-\\nчонка по промежуткам в охват людей пошла, — с петлями\\nу ней круги стали. Потом и вовсе за людей вышла и опять\\nровненько закружилась, а сама уже ростом с Федюньку.\\nУ большой сосны остановилась, топнула ножкой, зубенками\\nблеснула, платочком махнула, как свистнула:\\n\\n— Фи-т-ть! й-ю-ю-у...\\n\\nТут филин заухал, захохотал, и никакой девчонки не\\nстало.\\n\\nКабы одни большие сидели, так, может, ничего бы даль-\\nше и не случилось. Каждый, видишь, подумал:\\n\\n«Вот до чего на огонь загляделся! В глазах зарябило...\\nНеведомо что померещится`с устатку-то!»\\n\\nОдин Федюнька этого не подумал и спрашивает у отца:\\n\\n— Тятя, это кто?\\n\\nОтец отвечает:\\n\\n— Филин. Кому больше-то? Неуж не слыхал, как он\\nухает?\\n\\n— Да не про филина я! Его-то, поди-ка, знаю и ни ка-\\nпельки не боюсь. Ты мне про девчонку скажи.\\n\\n— Про какую девчонку?\\n\\n— А вот которая на углях плясала. Еще ты и все отодви-\\nгались, как она широким кругом пошла.\\n\\nТут отец и другие старатели давай доспрашивать Фе-\\nдюньку, что он видел. Парнишечко рассказал. Один стара-\\nтель еше спросил:\\n\\n169\\n\"\n\n\nВидим, что есть проблема с распознаванием рисунка в книге в качестве симоволов. Попробуем это поправить!"
  },
  {
    "objectID": "about.html#преобразуем-pdf-в-страницы-png",
    "href": "about.html#преобразуем-pdf-в-страницы-png",
    "title": "Этапы работы и результаты",
    "section": "Преобразуем pdf в страницы png",
    "text": "Преобразуем pdf в страницы png\n\npdf_convert(\"./Бажов_вырезка.pdf\", \n            format = \"png\", \n            dpi = 300,\n            pages = NULL,\n            filenames = NULL)\n\nДумаю, что лучше всего в нашем случае будет просто обрезать рисунок\n\nlibrary(magick)\nimg &lt;- image_read(\"Бажов_вырезка_1.png\")\nimg_cropped &lt;- image_crop(img, \"100%x100%+0%+1100%\")  #методом подбора\nimage_write(img_cropped, \"Бажов_вырезка_1.png\")"
  },
  {
    "objectID": "about.html#запустим-ocr-на-наших-картинках",
    "href": "about.html#запустим-ocr-на-наших-картинках",
    "title": "Этапы работы и результаты",
    "section": "Запустим OCR на наших картинках",
    "text": "Запустим OCR на наших картинках\n\npng_files &lt;- list.files(pattern = \"Бажов_вырезка_.*\\\\.png$\", full.names = TRUE)\nsorted_png_files &lt;- png_files[order(as.numeric(gsub(\".*_(\\\\d+).*\\\\.png$\", \"\\\\1\", png_files)))]\nocr_text &lt;- tesseract::ocr(sorted_png_files, engine = \"rus\")\nhead (ocr_text,2)\n\n[1] \"ОГНЕВУШКА-ПОСКАКУШКА\\n\\n(Сидели раз старатели круг огонька в лесу. Четверо\\nбольших, а пятый парнишечко. Лет так восьми, не больше,\\nФедюнькой его звали.\\n\\nДавно всем спать пора, да разговор занятный пришелся.\\nВ артелке, видишь, один старик был. Дедко Ефим. С моло-\\nдых годов он из земли золотую крупку выбирал. Мало ли\\nкаких случаев у него бывало. Он и рассказывал, а старатели\\nслушали.\\n\\nОтец уж сколько раз говорил Федюньке!\\n\\n— Ложился бы ты, Тюньша, спать!\\n\\nПарнишечку охота послушать.\\n\\n— Погоди, тятенька! Я маленечко еще посижу.\\n\\nНу, вот.... Кончил дедко Ефим рассказ. На месте костер-\\nка одни угольки остались, а старатели всё сидят да на эти\\nугольки глядят.\\n\\n168\\n\"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              \n[2] \"Вдруг из самой серединки вынырнула девчоночка махонь-\\nка. Вроде кукленки, а живая. Волосенки рыженькие, сара-\\nфанчик голубенький и в руке платочек, тоже сголуба *.\\n\\nПоглядела девчонка веселыми глазками, блеснула зубен-\\nками, подбоченилась, платочком махнула и пошла плясать.\\nИ так у ней легко да ловко выходит, что и сказать нельзя.\\nУ старателей дух захватило. Глядят — не наглядятся, а сами\\nмолчат, будто задумались.\\n\\nДевчонка сперва по уголькам круги давала, потом, — вид-\\nно, ей тесно стало, — пошире пошла. Старатели отодвигают-\\nся, дорогу дают, а девчонка как круг пройдет, так и подрастет\\nмаленько. Старатели дальше отодвинутся. Она еще круг даст\\nи опять подрастет. Когда вовсе далеко отодвинулись, дев-\\nчонка по промежуткам в охват людей пошла,— с петлями\\nу ней круги стали. Потом и вовсе за людей вышла и опять\\nровненько закружилась, а сама уже ростом с Федюньку.\\nУ большой сосны остановилась, топнула ножкой, зубенками\\nблеснула, платочком махнула, как свистнула:\\n\\n— Фи-т-ть! Й-ю-ю-у...\\n\\nТут филин заухал, захохотал, и никакой девчонки не\\nстало.\\n\\nКабы одни большие сидели, так, может, ничего бы даль-\\nше и не случилось. Каждый, видишь, подумал:\\n\\n«Вот до чего на огонь загляделся! В глазах зарябило...\\nНеведомо что померещится`с устатку-то!»\\n\\nОдин Федюнька этого не подумал и спрашивает у отца:\\n\\n— Тятя, это кто?\\n\\nОтец отвечает:\\n\\n— Филин. Кому больше-то? Неуж не слыхал, как он\\nухает?\\n\\n— Да не про филина я! Его-то, поди-ка, знаю и ни ка-\\nпельки не боюсь. Ты мне про девчонку скажи.\\n\\n— Про какую девчонку?\\n\\n— А вот которая на углях плясала. Еще ты и все отодви-\\nгались, как она широким кругом пошла.\\n\\nТут отец и другие старатели давай доспрашивать Фе-\\nдюньку, что он видел. Парнишечко рассказал. Один стара-\\nтель еще спросил:\\n\\n169\\n\"\n\n\nИ склеим всё, что нам распознала эта чудо-машина в текстовый файл\n\nwriteLines(ocr_text, con = \"./Бажов_OCR.txt\")"
  },
  {
    "objectID": "about.html#загрузим-распознанный-нами-текст",
    "href": "about.html#загрузим-распознанный-нами-текст",
    "title": "Этапы работы и результаты",
    "section": "Загрузим распознанный нами текст",
    "text": "Загрузим распознанный нами текст\n\nlibrary(stringr)\ntext &lt;- readLines(con = \"./Бажов_OCR.txt\")\nhead(text,27)\n\n [1] \"ОГНЕВУШКА-ПОСКАКУШКА\"                                      \n [2] \"\"                                                          \n [3] \"(Сидели раз старатели круг огонька в лесу. Четверо\"        \n [4] \"больших, а пятый парнишечко. Лет так восьми, не больше,\"   \n [5] \"Федюнькой его звали.\"                                      \n [6] \"\"                                                          \n [7] \"Давно всем спать пора, да разговор занятный пришелся.\"     \n [8] \"В артелке, видишь, один старик был. Дедко Ефим. С моло-\"   \n [9] \"дых годов он из земли золотую крупку выбирал. Мало ли\"     \n[10] \"каких случаев у него бывало. Он и рассказывал, а старатели\"\n[11] \"слушали.\"                                                  \n[12] \"\"                                                          \n[13] \"Отец уж сколько раз говорил Федюньке!\"                     \n[14] \"\"                                                          \n[15] \"— Ложился бы ты, Тюньша, спать!\"                           \n[16] \"\"                                                          \n[17] \"Парнишечку охота послушать.\"                               \n[18] \"\"                                                          \n[19] \"— Погоди, тятенька! Я маленечко еще посижу.\"               \n[20] \"\"                                                          \n[21] \"Ну, вот.... Кончил дедко Ефим рассказ. На месте костер-\"   \n[22] \"ка одни угольки остались, а старатели всё сидят да на эти\" \n[23] \"угольки глядят.\"                                           \n[24] \"\"                                                          \n[25] \"168\"                                                       \n[26] \"\"                                                          \n[27] \"Вдруг из самой серединки вынырнула девчоночка махонь-\"     \n\n\nВидим, что у нас остались номера страниц и дополнительные маленькие артефакты неправильного распознавания текста. Чуть-чуть подкорректируем."
  },
  {
    "objectID": "about.html#удалим-все-строки-с-цифрами---в-нашем-случае-это-номера-страниц-они-нам-ни-к-чему",
    "href": "about.html#удалим-все-строки-с-цифрами---в-нашем-случае-это-номера-страниц-они-нам-ни-к-чему",
    "title": "Этапы работы и результаты",
    "section": "Удалим все строки с цифрами - в нашем случае это номера страниц, они нам ни к чему",
    "text": "Удалим все строки с цифрами - в нашем случае это номера страниц, они нам ни к чему\n\ntext2 &lt;- text[!str_detect(text, \"\\\\d\")]\nhead(text2,27)\n\n [1] \"ОГНЕВУШКА-ПОСКАКУШКА\"                                      \n [2] \"\"                                                          \n [3] \"(Сидели раз старатели круг огонька в лесу. Четверо\"        \n [4] \"больших, а пятый парнишечко. Лет так восьми, не больше,\"   \n [5] \"Федюнькой его звали.\"                                      \n [6] \"\"                                                          \n [7] \"Давно всем спать пора, да разговор занятный пришелся.\"     \n [8] \"В артелке, видишь, один старик был. Дедко Ефим. С моло-\"   \n [9] \"дых годов он из земли золотую крупку выбирал. Мало ли\"     \n[10] \"каких случаев у него бывало. Он и рассказывал, а старатели\"\n[11] \"слушали.\"                                                  \n[12] \"\"                                                          \n[13] \"Отец уж сколько раз говорил Федюньке!\"                     \n[14] \"\"                                                          \n[15] \"— Ложился бы ты, Тюньша, спать!\"                           \n[16] \"\"                                                          \n[17] \"Парнишечку охота послушать.\"                               \n[18] \"\"                                                          \n[19] \"— Погоди, тятенька! Я маленечко еще посижу.\"               \n[20] \"\"                                                          \n[21] \"Ну, вот.... Кончил дедко Ефим рассказ. На месте костер-\"   \n[22] \"ка одни угольки остались, а старатели всё сидят да на эти\" \n[23] \"угольки глядят.\"                                           \n[24] \"\"                                                          \n[25] \"\"                                                          \n[26] \"Вдруг из самой серединки вынырнула девчоночка махонь-\"     \n[27] \"ка. Вроде кукленки, а живая. Волосенки рыженькие, сара-\"   \n\n\nКак будто всё и хорошо? Но нет, склеим переносы слов, чтобы было точно славно"
  },
  {
    "objectID": "about.html#склеиваем-переносы-слов",
    "href": "about.html#склеиваем-переносы-слов",
    "title": "Этапы работы и результаты",
    "section": "Склеиваем переносы слов",
    "text": "Склеиваем переносы слов\n\ntext3 &lt;- paste(text2, collapse = \"\\n\")\npattern &lt;- \"(\\\\p{L}+)-\\\\s*\\\\n\\\\s*(\\\\p{L}+)\"\ntext4 &lt;- gsub(pattern, \"\\\\1\\\\2\", text3, perl = TRUE)\nprint(text4)\n\nВидим, что в текст из-за ошибок в распознавании закралась скобка и одна опечатка, которых в самом тексте нет"
  },
  {
    "objectID": "about.html#внесем-коррективы-и-запишем-нормализованную-расшифровку-в-файл",
    "href": "about.html#внесем-коррективы-и-запишем-нормализованную-расшифровку-в-файл",
    "title": "Этапы работы и результаты",
    "section": "Внесем коррективы и запишем нормализованную расшифровку в файл",
    "text": "Внесем коррективы и запишем нормализованную расшифровку в файл\n\ntext5 &lt;- text4 |&gt;\n  str_remove_all(\"[()]\") |&gt;\n  str_replace_all('\\\"Гут', 'Тут')\nprint(text5)\n\nwriteLines(text5, con = \"./Бажов_NORM.txt\")"
  },
  {
    "objectID": "about.html#подготовка",
    "href": "about.html#подготовка",
    "title": "Этапы работы и результаты",
    "section": "",
    "text": "Я взяла в работу сборник Уральские сказы Павла Бажова (Бажов 1970) Выбрала сказ Огневушка-Поскакушка, он небольшой, но подходит формальным критериям."
  },
  {
    "objectID": "about.html#парсинг-и-пространство-имен",
    "href": "about.html#парсинг-и-пространство-имен",
    "title": "Этапы работы и результаты",
    "section": "Парсинг и пространство имен",
    "text": "Парсинг и пространство имен\n\nlibrary(xml2)\nlibrary(tidyverse)\nlibrary(dplyr)\nlibrary(purrr)\n\ndoc &lt;- read_xml(\"ОгневушкаTEI.xml\")\nns &lt;- xml_ns(doc)\n\nДокумент запарсили, задали пространство имён, давайте найдем что-нибудь интересное."
  },
  {
    "objectID": "about.html#смотрим-данные-по-тегу-persname",
    "href": "about.html#смотрим-данные-по-тегу-persname",
    "title": "Этапы работы и результаты",
    "section": "Смотрим данные по тегу persName",
    "text": "Смотрим данные по тегу persName\n\ncharacters &lt;- xml_find_all(doc, \"//d1:persName\", ns = ns) |&gt;\n  xml_text()\n\ncharacter_names &lt;- unique(characters)\n\ncharacter_counts &lt;- table(character_names) |&gt; \n  as.data.frame() |&gt; \n  arrange(desc(Freq))\n\nhead(character_counts)\n\n  character_names Freq\n1        дед Ефим    1\n2        Дед Ефим    1\n3     дедка Ефима    1\n4           дедко    1\n5      дедко Ефим    1\n6      Дедко Ефим    1\n\n\nВо-первых, явно нужно переименовать столбцы, чтоб было красиво.\n\ncolnames(character_counts) &lt;- c(\"Имя\", \"Частота\")\n\nhead(character_counts)\n\n          Имя Частота\n1    дед Ефим       1\n2    Дед Ефим       1\n3 дедка Ефима       1\n4       дедко       1\n5  дедко Ефим       1\n6  Дедко Ефим       1\n\n\nВо-вторых, у нас есть проблема с тем, что мы получили список имен во всех их вариациях, а нам нужны уникальные имена персонажей!\nЯ сделаю это вручную, так будет надежнее, можно было бы лемматизировать, конечно и безусловно… But and so…\n\n\n                   Имя Частота\n1             Федюнька      39\n2           дедко Ефим      35\n3 Огневушка-Поскакушка      24\n4            старатели      13\n5                 отец       8\n6               Мачеха       2\n7    Федюнькиного отца       1"
  }
]